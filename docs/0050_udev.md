# udev

## 参考文档

* [devfs udev](https://github.com/ZengjfOS/LinuxSystem/blob/master/docs/0005_devfs_udev.md)
* [[基礎] Raspberry Pi 用 3G 網卡(3G USB dongle)上網](https://www.raspberrypi.com.tw/tag/udev/)
* [udev (简体中文)](https://wiki.archlinux.org/index.php/Udev_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87))

## rules

`udev`规则以管理员身份编写并保存在`/etc/udev/rules.d/`目录，其文件名必须以`.rules`结尾。各种软件包提供的规则文件位于`/lib/udev/rules.d/`。如果`/usr/lib`和`/etc`这两个目录中有同名文件，则`/etc`中的文件优先。

## usb camera

* `udevadm info -a -p $(udevadm info -q path -n /dev/video0)`
  ```
  Udevadm info starts with the device specified by the devpath and then
  walks up the chain of parent devices. It prints for every device
  found, all possible attributes in the udev rules key format.
  A rule to match, can be composed by the attributes of the device
  and the attributes from one single parent device.
  
    looking at device '//devices/platform/scb/fd500000.pcie/pci0000:00/0000:00:00.0/0000:01:00.0/usb1/1-1/1-1.4/1-1.4:1.0/video4linux/video0':
      KERNEL=="video0"
      SUBSYSTEM=="video4linux"
      DRIVER==""
      ATTR{name}=="USB Camera: USB Camera"
      ATTR{dev_debug}=="0"
      ATTR{index}=="0"
  
    looking at parent device '//devices/platform/scb/fd500000.pcie/pci0000:00/0000:00:00.0/0000:01:00.0/usb1/1-1/1-1.4/1-1.4:1.0':
      KERNELS=="1-1.4:1.0"
      SUBSYSTEMS=="usb"
      DRIVERS=="uvcvideo"
      ATTRS{iad_bFunctionSubClass}=="03"
      ATTRS{supports_autosuspend}=="1"
      ATTRS{bInterfaceNumber}=="00"
      ATTRS{bInterfaceSubClass}=="01"
      ATTRS{iad_bFunctionClass}=="0e"
      ATTRS{bAlternateSetting}==" 0"
      ATTRS{iad_bFirstInterface}=="00"
      ATTRS{interface}=="USB Camera"
      ATTRS{bInterfaceProtocol}=="00"
      ATTRS{iad_bFunctionProtocol}=="00"
      ATTRS{bInterfaceClass}=="0e"
      ATTRS{authorized}=="1"
      ATTRS{bNumEndpoints}=="01"
      ATTRS{iad_bInterfaceCount}=="02"
  
    looking at parent device '//devices/platform/scb/fd500000.pcie/pci0000:00/0000:00:00.0/0000:01:00.0/usb1/1-1/1-1.4':
      KERNELS=="1-1.4"
      SUBSYSTEMS=="usb"
      DRIVERS=="usb"
      ATTRS{bNumConfigurations}=="1"
      ATTRS{bmAttributes}=="80"
      ATTRS{quirks}=="0x0"
      ATTRS{maxchild}=="0"
      ATTRS{devnum}=="3"
      ATTRS{authorized}=="1"
      ATTRS{tx_lanes}=="1"
      ATTRS{avoid_reset_quirk}=="0"
      ATTRS{configuration}=="Guillemot Corporation"
      ATTRS{rx_lanes}=="1"
      ATTRS{product}=="USB Camera"
      ATTRS{removable}=="unknown"
      ATTRS{idProduct}=="030a"
      ATTRS{speed}=="480"
      ATTRS{bDeviceSubClass}=="02"
      ATTRS{bDeviceProtocol}=="01"
      ATTRS{devspec}=="  (null)"
      ATTRS{idVendor}=="057e"
      ATTRS{bcdDevice}=="0924"
      ATTRS{urbnum}=="29"
      ATTRS{busnum}=="1"
      ATTRS{ltm_capable}=="no"
      ATTRS{devpath}=="1.4"
      ATTRS{bMaxPower}=="500mA"
      ATTRS{bConfigurationValue}=="1"
      ATTRS{bDeviceClass}=="ef"
      ATTRS{bNumInterfaces}==" 2"
      ATTRS{version}==" 2.00"
      ATTRS{manufacturer}=="Guillemot Corporation"
      ATTRS{bMaxPacketSize0}=="64"
  
    looking at parent device '//devices/platform/scb/fd500000.pcie/pci0000:00/0000:00:00.0/0000:01:00.0/usb1/1-1':
      KERNELS=="1-1"
      SUBSYSTEMS=="usb"
      DRIVERS=="usb"
      ATTRS{urbnum}=="40"
      ATTRS{version}==" 2.10"
      ATTRS{bNumConfigurations}=="1"
      ATTRS{devspec}=="  (null)"
      ATTRS{rx_lanes}=="1"
      ATTRS{idVendor}=="2109"
      ATTRS{bConfigurationValue}=="1"
      ATTRS{speed}=="480"
      ATTRS{bDeviceProtocol}=="01"
      ATTRS{bNumInterfaces}==" 1"
      ATTRS{bMaxPower}=="100mA"
      ATTRS{busnum}=="1"
      ATTRS{bDeviceSubClass}=="00"
      ATTRS{maxchild}=="4"
      ATTRS{bDeviceClass}=="09"
      ATTRS{bcdDevice}=="0420"
      ATTRS{idProduct}=="3431"
      ATTRS{bmAttributes}=="e0"
      ATTRS{product}=="USB2.0 Hub"
      ATTRS{quirks}=="0x0"
      ATTRS{removable}=="unknown"
      ATTRS{tx_lanes}=="1"
      ATTRS{devnum}=="2"
      ATTRS{devpath}=="1"
      ATTRS{avoid_reset_quirk}=="0"
      ATTRS{ltm_capable}=="no"
      ATTRS{configuration}==""
      ATTRS{authorized}=="1"
      ATTRS{bMaxPacketSize0}=="64"
  
    looking at parent device '//devices/platform/scb/fd500000.pcie/pci0000:00/0000:00:00.0/0000:01:00.0/usb1':
      KERNELS=="usb1"
      SUBSYSTEMS=="usb"
      DRIVERS=="usb"
      ATTRS{idProduct}=="0002"
      ATTRS{devspec}=="  (null)"
      ATTRS{bNumInterfaces}==" 1"
      ATTRS{quirks}=="0x0"
      ATTRS{product}=="xHCI Host Controller"
      ATTRS{authorized_default}=="1"
      ATTRS{devpath}=="0"
      ATTRS{speed}=="480"
      ATTRS{manufacturer}=="Linux 4.19.71-v7l xhci-hcd"
      ATTRS{rx_lanes}=="1"
      ATTRS{authorized}=="1"
      ATTRS{devnum}=="1"
      ATTRS{urbnum}=="32"
      ATTRS{avoid_reset_quirk}=="0"
      ATTRS{bConfigurationValue}=="1"
      ATTRS{bMaxPacketSize0}=="64"
      ATTRS{removable}=="unknown"
      ATTRS{maxchild}=="1"
      ATTRS{tx_lanes}=="1"
      ATTRS{bDeviceClass}=="09"
      ATTRS{idVendor}=="1d6b"
      ATTRS{configuration}==""
      ATTRS{bNumConfigurations}=="1"
      ATTRS{version}==" 2.00"
      ATTRS{ltm_capable}=="no"
      ATTRS{bmAttributes}=="e0"
      ATTRS{bMaxPower}=="0mA"
      ATTRS{bDeviceProtocol}=="01"
      ATTRS{bDeviceSubClass}=="00"
      ATTRS{serial}=="0000:01:00.0"
      ATTRS{bcdDevice}=="0419"
      ATTRS{busnum}=="1"
      ATTRS{interface_authorized_default}=="1"
  
    looking at parent device '//devices/platform/scb/fd500000.pcie/pci0000:00/0000:00:00.0/0000:01:00.0':
      KERNELS=="0000:01:00.0"
      SUBSYSTEMS=="pci"
      DRIVERS=="xhci_hcd"
      ATTRS{max_link_speed}=="5 GT/s"
      ATTRS{class}=="0x0c0330"
      ATTRS{broken_parity_status}=="0"
      ATTRS{revision}=="0x01"
      ATTRS{subsystem_device}=="0x3483"
      ATTRS{max_link_width}=="1"
      ATTRS{current_link_speed}=="5 GT/s"
      ATTRS{dma_mask_bits}=="64"
      ATTRS{driver_override}=="(null)"
      ATTRS{devspec}==""
      ATTRS{irq}=="56"
      ATTRS{enable}=="1"
      ATTRS{consistent_dma_mask_bits}=="64"
      ATTRS{local_cpulist}=="0-3"
      ATTRS{local_cpus}=="f"
      ATTRS{ari_enabled}=="0"
      ATTRS{device}=="0x3483"
      ATTRS{current_link_width}=="1"
      ATTRS{msi_bus}=="1"
      ATTRS{vendor}=="0x1106"
      ATTRS{subsystem_vendor}=="0x1106"
  
    looking at parent device '//devices/platform/scb/fd500000.pcie/pci0000:00/0000:00:00.0':
      KERNELS=="0000:00:00.0"
      SUBSYSTEMS=="pci"
      DRIVERS=="pcieport"
      ATTRS{irq}=="55"
      ATTRS{broken_parity_status}=="0"
      ATTRS{subordinate_bus_number}=="1"
      ATTRS{dma_mask_bits}=="32"
      ATTRS{secondary_bus_number}=="1"
      ATTRS{vendor}=="0x14e4"
      ATTRS{devspec}==""
      ATTRS{subsystem_vendor}=="0x0000"
      ATTRS{device}=="0x2711"
      ATTRS{revision}=="0x10"
      ATTRS{max_link_speed}=="5 GT/s"
      ATTRS{driver_override}=="(null)"
      ATTRS{enable}=="1"
      ATTRS{msi_bus}=="1"
      ATTRS{class}=="0x060400"
      ATTRS{aer_rootport_total_err_nonfatal}=="0"
      ATTRS{subsystem_device}=="0x0000"
      ATTRS{current_link_speed}=="5 GT/s"
      ATTRS{local_cpulist}=="0-3"
      ATTRS{current_link_width}=="1"
      ATTRS{max_link_width}=="1"
      ATTRS{local_cpus}=="f"
      ATTRS{consistent_dma_mask_bits}=="32"
      ATTRS{ari_enabled}=="0"
      ATTRS{aer_rootport_total_err_cor}=="0"
      ATTRS{aer_rootport_total_err_fatal}=="0"
  
    looking at parent device '//devices/platform/scb/fd500000.pcie/pci0000:00':
      KERNELS=="pci0000:00"
      SUBSYSTEMS==""
      DRIVERS==""
  
    looking at parent device '//devices/platform/scb/fd500000.pcie':
      KERNELS=="fd500000.pcie"
      SUBSYSTEMS=="platform"
      DRIVERS=="brcm-pcie"
      ATTRS{dmabounce_stats}=="m:0/0 s:0/0 f:0 s:0 b:0/0 a:0/0"
      ATTRS{driver_override}=="(null)"
  
    looking at parent device '//devices/platform/scb':
      KERNELS=="scb"
      SUBSYSTEMS=="platform"
      DRIVERS==""
      ATTRS{driver_override}=="(null)"
  
    looking at parent device '//devices/platform':
      KERNELS=="platform"
      SUBSYSTEMS==""
      DRIVERS==""
  ```